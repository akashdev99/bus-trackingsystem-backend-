{
  "_from": "express-flash-notification",
  "_id": "express-flash-notification@0.5.0",
  "_inBundle": false,
  "_integrity": "sha1-ZqJ0jJ0MOwHM2/oN19uEc/T7CSc=",
  "_location": "/express-flash-notification",
  "_phantomChildren": {},
  "_requested": {
    "escapedName": "express-flash-notification",
    "fetchSpec": "latest",
    "name": "express-flash-notification",
    "raw": "express-flash-notification",
    "rawSpec": "",
    "registry": true,
    "saveSpec": null,
    "type": "tag"
  },
  "_requiredBy": [
    "#USER",
    "/"
  ],
  "_resolved": "https://registry.npmjs.org/express-flash-notification/-/express-flash-notification-0.5.0.tgz",
  "_shasum": "66a2748c9d0c3b01ccdbfa0dd7db8473f4fb0927",
  "_shrinkwrap": null,
  "_spec": "express-flash-notification",
  "_where": "D:\\project\\bus-trackingsystem-backend-",
  "author": {
    "email": "ascari.gtz@gmail.com",
    "name": "Ascari Gutierrez Hermosillo"
  },
  "bugs": {
    "url": "https://github.com/carlosascari/express-flash-notification/issues"
  },
  "bundleDependencies": false,
  "dependencies": {
    "async": "^0.9.0"
  },
  "deprecated": false,
  "description": "Express.js flash notifications that works with any template engine",
  "devDependencies": {},
  "homepage": "https://github.com/carlosascari/express-flash-notification#readme",
  "keywords": [
    "express",
    "flash",
    "flash message",
    "flash notification",
    "hogan",
    "logicless",
    "mustache",
    "notification"
  ],
  "license": "MIT",
  "main": "index.js",
  "name": "express-flash-notification",
  "optionalDependencies": {},
  "readme": "# [express-flash-notification]()\n\nThis module provides a way to set one-time notifications to be displayed during or after processing a request. \nNotifications are stored in session and are removed once they have been rendered.\n\n**Key Points**\n\n- **Template engine agnostic**, works with any engine you are using (logic/logicless).\n- Supports for **multiple notifications** to be sent.\n- **Auto refreshes or redirects** the page to display the notification.\n- Allows you to manipulate the notification output **before and after** it has been created.\n  This allows you to control the presentation of all notifications with custom html/js.\n- **No need to refresh or redirect**, notifications can be rendered on the same request.\n\nIf you want to see it in action: [express-flash-notification-example](https://github.com/carlosascari/express-flash-notification-example)\n\n### Why?\n\nI realized [connect-flash](https://github.com/jaredhanson/connect-flash) required a template engine with conditional logic to test wether or not to show content. \nImplementation felt akward when applying this middleware to a logic-less tempalte engine like Mustache. \nSo I wrote a flash notification that can be used in any template engine.\n\n## Install\n```\nnpm i express-flash-notification --save\n```\n## Usage\n\nFlash notifications are stored in a `session`. \nYou will need the `cookieParser` middleware and the `session` middleware installed. \nDepending on your express version it may be bundled in express or for newer releases you will have to `npm install` them as seperate modules. \n - Using express 4.x in the following examples.\n - Using Mustache template engine in the following examples.\n\nYou must pass the express application instance as the first argument in  the `flash()` middleware so the middleware can take advantage of the `app.render` method in order to create your notification using your own template engine and `views` directory.\n\n```javascript\nconst flash = require('express-flash-notification');\nconst cookieParser = require('cookie-parser');\nconst session = require('express-session');\n\nconst app = express();\n\n// setup views directory, view engine, etc...\n\napp.use(cookieParser());\napp.use(session({...}}));\napp.use(flash(app));\n```\n\n##### In your Layout\n\nWherever you place the local variable `flash`, it will be populated with the notifications if there are any. Make sure it does not escape, as the output *may* be HTML.\n\n```html5\n<!DOCTYPE html>\n<html>\n<head>\n  <title></title>\n</head>\n<body>\n  {{{flash}}}\n</body>\n</html>\n```\n\n**NOTICE**: If you are using the `ejs` template engine, please keep in mind that variables are stored in a locals objects. \nSo in the above template you would use: `<%- locals.flash %>` for unescaped html and `<%= locals.message %>` for escaped html.\n\n##### In your Views\n\n**By default, a view named `flash` in your `views` directory will be retrieved and used as the default template for your notifications.**\n\nThe local variables `type` and `message` will be set, depending on the type and message passed when calling **req.render**\n\n*flash.html*\n\n```html\n<div class=\"alert flash\">\n  <button type=\"button\" class=\"close\">×</button>\n  <i class=\"fa sign\"></i><strong>{{type}}</strong> \n  <span>{{message}}</span>\n</div>\n```\n\n### req.flash API\n\nThere are several ways to trigger a flash notification:\n\n**Note** A `notification` is a *Object* with properties that become local view variables when rendering, using the express rendering engine of your choice.\n\n- **req.flash**(*String* message)\n  Sets local variable `message` to the string provided.\n  Sets local variable `type` to a empty string. \n  Will refresh the current page.\n\n- **req.flash**(*String* type, *String* message)\n  First string is the `type` local variable, the second is the `message` local variable. \n  Will refresh the current page.\n\n- **req.flash**(*String* type, *String* message, *String* redirectUrl)\n  Last argument as a *String* defines which page to redirect to.\n\n- **req.flash**(*String* type, *String* message, *Boolean* renderInThisRequest)\n  Third argument as a *Boolean* determines whether or not to refresh the page.\n  **NOTE** If set to `false`, notifications will not be rendered until the next request.\n  If you still want the notification to be rendered on the current request, you can use a function that is returned by `req.flash`\n  Call the function with a callback, the callback will be executed once rendering is complete.\n  **example**\n  ```\n  app.all(function SampleExpressRoute(req, res) {\n    const manualRender = req.flash('warn', 'tell them now!', false);\n    manualRender(function(error) {\n      if (error) throw error\n      res.render('layouts/internal');\n    })\n  })\n  ```\n\n- **req.flash**(*Object* notification)\n  You can pass an object as the first argument, the object's properties will be exposed as local variables when rendering the notification template.\n  The property `redirect` is reserved and functions just as you'd expect; a *Boolean* determines if it will refresh, or as a *String* you specify where to redirect to.\n  ```javascript\n  req.flash('info', 'if cats ruled the world', false)\n  ``` \n  is treated exactly the same as:\n  ```javascript\n  req.flash({\n    type: 'info',\n    message: 'if cats rules the world',\n    redirect: false\n  })\n  ```\n\n### Usage Example\n\nWith the `flash` middleware in place, all requests will have a `req.flash()` method to send out flash notifications.\n\n```javascript\napp.use('/login', function loginProcessor(req, res, next) {\n  if (req.method !== 'POST') return next();\n  if (!req.body) return next(new Error('no data was sent to the server, please try again'));\n  \n  const user = req.body.user;\n  const pass = req.body.pass;\n\n  if (user && pass) {\n    if (user === 'root' && pass === 'toor') {\n      res.redirect('/dashboard');\n    } else {\n      req.flash('info', 'invalid username or password');\n    }\n  } else {\n    req.flash('info', 'you must enter your username and password to login');\n  }\n});\n\napp.use('/login', function loginErrorHandler(error, req, res, next) {\n  if (error.message) {\n    req.flash('error', error.message);\n  } else {\n    console.log('there was a nasty login error: %s', error.stack);\n    next();\n  }\n});\n\napp.get('/login', function loginRenderer(req, res, next) {\n  res.render('external', {\n    partials: {\n      content: 'external/login'\n    }\n  });\n});\n```\n\n###### Pitfalls \n\nBy default, **req.flash** will redirect to the current url, effectively refreshing the page so to display the flash notification. \nIt is important that your logic uses `return` when using flash or some form of conditioning so you don't get the *headers have already been sent* error. \n\nFor example below, if 2 + 2 ever equals 'fish' the `req.flash` method will send out the redirect headers, and execution will continue until the `next` function is called, the `next` call will also try to set the response headers.\n\n```javascript\napp.use('/get-busy', function(req, res, next) {\n  if (2 + 2 === 'fish') {\n    req.flash('error', 'fairies!');\n  }\n  \n  // ... other logics go here\n  next();\n})\n```\n\nKeeping in mind the case above, and in case you want to send multiple notifications you can disable the redirect by setting the third parameter to `false`.\n\n```javascript\napp.use('/get-busy', function(req, res, next) {\n  if (2 + 2 === 'fish') {\n    return req.flash('error', 'fairies!', '/impossible');\n  }\n  \n  // ... other logics go here\n\n  // headers are not set, so calling next is safe\n  req.flash('success', 'logics are done', false); \n\n  next();\n})\n```\n\n----------------\n\n## Advance Configuration\n\nWhen setting the flash middleware, the second parameter accepts an object for configuration.\nBelow is an example with all the options set to their defaults.\n\n```javascript\napp.use(flash(app, {\n  sessionName: 'flash',\n  utilityName: 'flash',\n  localsName: 'flash',\n  viewName: 'flash',\n  beforeSingleRender: function(item, callback){ callback(null, item) },\n  afterAllRender: function(htmlFragments, callback){ callback(null, htmlFragments.join('\\n')) }\n}));\n```\n\n- **sessionName** Is the key used to store the notifications in session: `req.session[sessionName]`\n\n- **utilityName** Is the name of the function that is exposed in the `req` object, the one used to add new notifications: `req[utilityName]('info', 'hello')`\n\n- **localsName** Is the `locals` variable name where all your notifications will be placed, make sure it does not escape HTML: `{{{localsName}}}`\n\n- **viewName** Is the name of the view that will be used as the template for all notifications: `app/views/viewName.html`\n\n- **beforeSingleRender** Is called right before each notification is rendered, allowing you to add/remove or modify the local variables passed to the renderer.\nThe first argument is an object with all the locals variables set, typically you will find `item.type` and `item.message` here. The second argument is a callback that must be called with `null` or an `Error` for the first parameter, and an object with the locals used to render on the second parameter.\n\n- **afterAllRender** Is called after all notifications have been compiled. Allowing you to append anything like extra HTML to the output.\nThe first argument, is an array with each rendered notification. The second argument is a callback that must be called with `null` or an `Error` for the first parameter, and the resulting notifications output **not as an Array but as a String** (Array.join)\n\n-----------------\n\n## Advance Usage\n\nHeres an example where custom notifications will be rendered, `beforeSingleRender` is used to add class names depending on the `type` of notification so the resulting notification looks different depending on its type. Also, `afterAllRender` will be used to append some javascript so notification don't just appear, they slide into view.\n\n**NOTE** `{{{flash}}}` is placed in my layout, not shown here\n\nThis is my `flash.html` view template.\n`alert_class` and `icon_class` will be populated inside of `beforeSingleRender`\n`style=\"display: none\"` is set so the appended javascript uses jQuery's `slideDown` method to animate its presentation\n\n```html\n<div class=\"alert flash {{alert_class}}\" style=\"display:none\">\n  <button type=\"button\" class=\"close\">×</button>\n  <i class=\"fa {{icon_class}} sign\"></i><strong>{{type}}</strong> \n  <span>{{{message}}}</span>\n</div>\n```\n\nThis is the setup\n\n```javascript\n\napp.use(require('express-flash-notification')(app, {\n  viewName:    'elements/flash',\n  beforeSingleRender: function(notification, callback) {\n    if (notification.type) {\n      switch(notification.type) {\n        case 'error':\n          notification.alert_class = 'alert-danger'\n          notification.icon_class = 'fa-times-circle'\n        break;\n        case 'alert':\n          notification.alert_class = 'alert-warning'\n          notification.icon_class = 'fa-times-circle'\n        break;\n        case 'info':\n          notification.alert_class = 'alert-info'\n          notification.icon_class = 'fa-times-circle'\n        break;\n        case 'success':\n          notification.alert_class = 'alert-success'\n          notification.icon_class = 'fa-check'\n        break;\n        case 'ok':\n          notification.alert_class = 'alert-primary'\n          notification.icon_class = 'fa-check'\n        break;\n      }\n    }\n    callback(null, notification)\n  },\n  afterAllRender: function(htmlFragments, callback) {\n    // Naive JS is appened, waits a while expecting for the DOM to finish loading,\n    // The timeout can be removed if jOuery is loaded before this is called, or if you're using vanilla js.\n    htmlFragments.push([\n      '<script type=\"text/javascript\">',\n      ' var timer = setInterval(function(){',\n      '      if (window.jOuery){',\n      '            clearInterval(timer)',\n      '            $(\".alert.flash\").slideDown().find(\".close\").on(\"click\", function(){$(this).parent().slideUp()})',\n      '      }',\n      ' }, 200)',\n      '</script>',\n    ].join(''))\n    callback(null, htmlFragments.join(''))\n  },\n}))\n```\n\n**And this is how you'd use it**\n\n```javascript\napp.use('/bleh/:ok', function(req, res, next) {\n  if (req.params.ok) {\n    req.flash('ok', 'Everything is A-O-K');\n  } else {\n    req.flash('warn', 'Quick! everybody panic!');\n  }\n});\n```\n\n## License\n\n[The MIT License](http://opensource.org/licenses/MIT)",
  "readmeFilename": "README.md",
  "repository": {
    "type": "git",
    "url": "git://github.com/carlosascari/express-flash-notification.git"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "version": "0.5.0"
}
